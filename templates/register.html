{% extends 'base.html' %}

{% block title %}Register — Healix{% endblock %}

{% block content %}
  <div class="form-card mx-auto" style="max-width:920px">
    <h2 class="mb-1">Create your account</h2>
    <p class="muted">We’ll ask a few details to personalize your experience.</p>

    <form id="registerForm">
      <div class="mb-3">
        <label>Full name</label>
        <input class="form-control" type="text" id="full_name" name="full_name" placeholder="Your full name" />
      </div>
      <div class="mb-3">
        <label>Email</label>
        <input class="form-control" type="email" name="email" placeholder="you@example.com" required />
      </div>
      <div class="mb-3">
        <label>Password</label>
        <input class="form-control" type="password" name="password" placeholder="••••••••" required />
      </div>

      <h3>Basics</h3>
      <div class="row g-3">
        <div class="col-md-4">
          <label>Date of birth</label>
          <input class="form-control" type="date" id="dob" />
        </div>
        <div class="col-md-4">
          <label>Gender</label>
          <select class="form-select" id="gender">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="col-md-4">
          <label>Blood group</label>
          <select class="form-select" id="blood_group">
            <option value="">Select</option>
            <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
          </select>
        </div>
      </div>

      <h3>Body metrics</h3>
      <div class="row g-3">
        <div class="col-md-6">
          <label>Height (cm)</label>
          <input class="form-control" id="height_cm" type="number" placeholder="e.g., 175" />
        </div>
        <div class="col-md-6">
          <label>Weight (kg)</label>
          <input class="form-control" id="weight_kg" type="number" placeholder="e.g., 70" />
        </div>
      </div>

      <h3>History & allergies</h3>
      <div class="mb-2">
        <label>Known conditions</label>
        <textarea class="form-control" id="known_conditions" rows="2" placeholder="e.g., Hypertension"></textarea>
      </div>
      <div class="mb-2">
        <label>Allergies</label>
        <textarea class="form-control" id="allergies" rows="2" placeholder="e.g., Penicillin"></textarea>
      </div>
      <div class="mb-2">
        <label>Food tolerance</label>
        <textarea class="form-control" id="food_tolerance" rows="2" placeholder="e.g., Lactose intolerant"></textarea>
      </div>

      <h3>Lifestyle</h3>
      <div class="row g-3">
        <div class="col-md-3">
          <label>Smoking</label>
          <select class="form-select" id="smoking">
            <option value="">Select</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div class="col-md-3">
          <label>Alcohol</label>
          <select class="form-select" id="alcohol">
            <option value="">Select</option>
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div class="col-md-3">
          <label>Physical activity</label>
          <select class="form-select" id="physical_activity">
            <option value="">Select</option>
            <option value="low">Low</option>
            <option value="moderate">Moderate</option>
            <option value="high">High</option>
          </select>
        </div>
        <div class="col-md-3">
          <label>Diet type</label>
          <select class="form-select" id="diet_type">
            <option value="">Select</option>
            <option value="veg">Vegetarian</option>
            <option value="nonveg">Non-vegetarian</option>
            <option value="vegan">Vegan</option>
          </select>
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary" type="submit">Create account</button>
        <a class="btn btn-outline-secondary" href="/auth/google">Google</a>
      </div>

    </form>

    <p id="msg" class="mt-3"></p>
    <p class="mt-2 text-muted"><a href="/login">Already have an account? Sign in</a></p>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    // dob uses a native date input (YYYY-MM-DD)
    const dobEl = document.getElementById('dob');

    const form = document.getElementById('registerForm');
    const msg = document.getElementById('msg');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = {
        full_name: document.getElementById('full_name').value,
        email: form.email.value,
        password: form.password.value,
        dob: dobEl.value,
        gender: document.getElementById('gender').value,
        blood_group: document.getElementById('blood_group').value,
        height_cm: document.getElementById('height_cm').value,
        weight_kg: document.getElementById('weight_kg').value,
        known_conditions: document.getElementById('known_conditions').value,
        allergies: document.getElementById('allergies').value,
        food_tolerance: document.getElementById('food_tolerance').value,
        smoking: document.getElementById('smoking').value,
        alcohol: document.getElementById('alcohol').value,
        physical_activity: document.getElementById('physical_activity').value,
        diet_type: document.getElementById('diet_type').value,
      };
      const res = await fetch('/api/register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) });
      const j = await res.json();
      if(res.ok){
        msg.textContent = 'Registered. Redirecting to login...';
        setTimeout(()=>location.href='/login',1000);
      } else {
        msg.textContent = j.message || 'Registration failed';
      }
    });
  </script>
{% endblock %}